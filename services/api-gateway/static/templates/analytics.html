<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Bootstrap core CSS -->
    <link href="static/bootstrap_theme/bootstrap.css" rel="stylesheet" type="text/css">
    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="static/blocks.css">
    <link href="static/style.css" rel="stylesheet">
    <link rel="stylesheet" href="static/bootstrap_theme/icons.css">
    <link href="static/footer_style.css" rel="stylesheet">
    <title>Стоматологическая клиника «ПримаСтом»</title>
    <style>.tab-content > .tab-pane { display: none; } .tab-content > .active { display: block; } th, td { text-align: center; vertical-align: middle; }</style>
    <style>
        .equal-card {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 1rem;
            min-width: 250px;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="text-muted">
<div id="app">
    <header class="bg-white">
        <div class="navbar-light">
            <div class="container">
                <div class="align-items-center gx-2 py-3 row">
                    <div class="col"> <a class="align-items-center d-inline-flex fw-bold h4 mb-0 navbar-brand text-uppercase" href="administrator_account.html"> <svg version="1.0" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 100 100" width="2.5em" height="2.5em" class="me-1 text-primary" fill="currentColor">
                                        <path d="M90 42.301 76.666 19.209l-13.334 7.699V10H36.667v16.908l-13.335-7.699L10 42.301 23.332 50 10 57.698l13.331 23.093 13.335-7.698V90h26.666V73.093l13.334 7.698L90 57.698 76.666 50 90 42.301zm-9.107 17.84-6.666 11.543-17.561-10.138v21.787H43.332V61.546L25.774 71.684l-6.666-11.543L36.667 50 19.108 39.863l6.666-11.549 17.558 10.14V16.667h13.334v21.787l17.561-10.14 6.666 11.549L63.332 50l17.561 10.141z"/>
                                    </svg><span>Примастом</span></a>
                    </div>
                    <div class="col-auto">
                        <div class="align-items-center d-inline-flex gap-2 gap-lg-3 py-1"> <a class="align-items-center d-inline-flex gap-2 lh-1 text-decoration-none"> <span class="bg-primary lh-1 p-2 rounded text-white"> <svg viewBox="0 0 24 24" fill="currentColor" width="1.25em" height="1.25em">
                                                <path d="M21 16.42v3.536a1 1 0 0 1-.93.998c-.437.03-.794.046-1.07.046-8.837 0-16-7.163-16-16 0-.276.015-.633.046-1.07A1 1 0 0 1 4.044 3H7.58a.5.5 0 0 1 .498.45c.023.23.044.413.064.552A13.901 13.901 0 0 0 9.35 8.003c.095.2.033.439-.147.567l-2.158 1.542a13.047 13.047 0 0 0 6.844 6.844l1.54-2.154a.462.462 0 0 1 .573-.149 13.901 13.901 0 0 0 4 1.205c.139.02.322.042.55.064a.5.5 0 0 1 .449.498z"/>
                                            </svg> </span> <div class="d-lg-block d-none">
                            <div class="mb-1 small text-black">Связаться с нами</div>
                            <div class="mb-1 small text-black"></div>
                            <div class="fw-bold">+7(423)226-54-96</div>
                        </div> </a><a class="align-items-center d-inline-flex gap-2 lh-1 text-decoration-none"> <span class="bg-primary lh-1 p-2 rounded text-white"> <svg viewBox="0 0 24 24" fill="currentColor" width="1.25em" height="1.25em">
                                                <path d="M18.364 17.364L12 23.728l-6.364-6.364a9 9 0 1 1 12.728 0zM12 13a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
                                            </svg> </span> <div class="d-lg-block d-none">
                            <div class="mb-1 small text-black">Адрес</div>
                            <div class="fw-bold">Владивосток, <br>ул. Светланская, 33</div>
                        </div> </a>
                        </div>
                    </div>
                    <div class="col-auto">
                        <!-- Имя пользователя
                         и поповер управления профилем -->
                        <div id="admin-profile" class="position-relative" v-cloak>
                            <button @click="isPopoverVisible = !isPopoverVisible" class="btn btn-primary" type="button">
                                {{ fullName }}
                            </button>
                            <div v-if="isPopoverVisible" class="card shadow-sm position-absolute p-3" style="top: 60px; right: 0; z-index: 1050; min-width: 200px;">
                                <div class="fw-bold mb-2">{{ fullName }}</div>
                                <div class="d-grid gap-2">
                                    <a href="administrator_profile.html" class="btn btn-outline-primary btn-sm">Управление профилем</a>
                                    <a href="auth_doc.html" class="btn btn-outline-danger btn-sm">Выйти</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="m-0">
            </div>
        </div>
        <div class="d-flex justify-content-center align-items-center flex-wrap w-100 ">
            <a id="admin_profile" role="button" class="border-white btn btn-outline-light fs-3 text-primary w-50" href="administrator_account.html">Панель администратора</a>
        </div>
        <div class="container">
            <hr class="m-0">
        </div>
        <nav class="navbar navbar-expand-lg pb-0 pt-0 sticky-top">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggler11" aria-controls="" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse w-100" id="navbarToggler11">
                <div class="container my-2">
                    <div class="d-flex flex-wrap gap-3 justify-content-center">
                        <a class="btn btn-lg btn-light border shadow-sm px-4 py-2 d-flex align-items-center gap-2" href="administrator_account.html"> <i class="bi bi-display"></i> Главная </a>
                        <a class="btn btn-lg btn-light border shadow-sm px-4 py-2 d-flex align-items-center gap-2" href="admins_schedule_management.html"> <i class="bi bi-calendar3"></i> Управление расписанием </a>
                        <a class="btn btn-lg btn-light border shadow-sm px-4 py-2 d-flex align-items-center gap-2" href="admins_patient_list.html"> <i class="bi bi-person-fill-gear"></i>Список пациентов </a>
                        <a class="btn btn-lg btn-light border shadow-sm px-4 py-2 d-flex align-items-center gap-2" href="admins_doctor_list.html"><i class="bi bi-person-badge"></i> Список врачей </a>
                        <a class="btn btn-lg btn-light border shadow-sm px-4 py-2 d-flex align-items-center gap-2" href="admins_admin_list.html"><i class="bi bi-person-lines-fill"></i> Список администраторов </a>
                        <a class="btn btn-lg btn-light border shadow-sm px-4 py-2 d-flex align-items-center gap-2" href="price_list.html"> <img src="static/img/ruble-sign-solid.svg" style="width: 18px; height: 18px"></img> Прейскурант </a>
                        <!-- <div v-if="admin.role === 'superadmin'"> -->
                            <a class="btn btn-lg btn-light border shadow-sm px-4 py-2 d-flex align-items-center gap-2" href="analytics.html"> <i class="bi bi-graph-up"></i> Статистика </a>
                        <!-- </div> -->
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <div class="container">
            <div class="align-items-center flex-wrap w-100 mt-3">
                <h3 class="mb-3 text-center">Статистика</h3>
            </div>
            <div class="card p-4">
                <ul class="nav nav-tabs justify-content-center mb-3 fs-5" id="analyticsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">Общий обзор</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="doctors-tab" data-bs-toggle="tab" data-bs-target="#doctors" type="button" role="tab">Врачи</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="patient-tab" data-bs-toggle="tab" data-bs-target="#patients" type="button" role="tab">Пациенты</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="finance-tab" data-bs-toggle="tab" data-bs-target="#finance" type="button" role="tab">Финансы</button>
                    </li>
                </ul>
                <div class="tab-content">
                    <!-- Общий обзор -->
                    <div class="tab-pane fade show active text-black fs-5" id="overview" role="tabpanel">
                        <h5>Общий обзор</h5>
                        <div class="row text-center my-3 align-items-stretch">
                            <div class="col-md-4 d-flex">
                                <div class="equal-card border rounded bg-light w-100 d-flex flex-column justify-content-between">
                                    <div>
                                        <h5>Всего пациентов</h5>
                                        <p class="fs-4">{{ stats.totalPatients }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 d-flex">
                                <div class="equal-card border rounded bg-light w-100 d-flex flex-column justify-content-between">
                                    <div>
                                        <h5>Проведено приёмов</h5>
                                        <p class="fs-4">{{ stats.totalVisits }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 d-flex">
                                <div class="equal-card border rounded bg-light w-100 d-flex flex-column justify-content-between">
                                    <div>
                                        <h5>Топ-3 услуги (кол-во)</h5>
                                        <p class="fs-4 mb-0">
                        <span v-for="(service, i) in stats.topServices" :key="service.name">
                            {{ service.name }} ({{ service.count }})<span v-if="i < stats.topServices.length - 1">, </span>
                        </span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- По врачам -->
                    <div class="tab-pane fade text-black fs-5" id="doctors" role="tabpanel">
                        <h5>Статистика по врачам</h5>
                        <div class="table-responsive mt-3 align-items-stretch">
                            <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                <th>Врач</th>
                                <th>Ср. количество приёмов/нед.</th>
                                <th>Средний чек</th>
                                <th>Всего пациентов</th>
                                </thead>
                                <tbody id="doctorStats">
                                <tr v-for="(doc, index) in stats.doctorAvgVisit" :key="doc.doctor">
                                    <td>{{ doc.doctor }}</td>
                                    <td>{{ doc.avgWeeklyVisits }}</td>
                                    <td>{{ stats.doctorCheckStat[index]?.avgCheck ?? '--' }}</td>
                                    <td>{{ stats.doctorUniquePatients[index]?.uniquePatients ?? '--' }}</td>
                                </tr>
                                </tbody>
                            </table>
                            </div>
                        </div>
                    </div>
                    <!-- Пациенты -->
                    <div class="tab-pane fade text-black" id="patients" role="tabpanel">
                        <h5>Пациенты</h5>
                        <div class="row  text-center my-3 align-items-stretch">
                            <div class="col-md-4">
                                <div class="equal-card border rounded bg-light">
                                    <h5>Новые пациенты за месяц</h5>
                                    <p class="fs-4">{{ stats.newPatientsThisMonth }}</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="equal-card border rounded bg-light">
                                    <h5>Среднее количество визитов на пациента</h5>
                                    <p class="fs-4">{{ stats.avgVisitPerPatient }}</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="equal-card border rounded bg-light">
                                    <h5>Возрастное распределение</h5>
                                    <ul class="fs-5 ps-3 mb-0">
                                        <li v-for="group in stats.ageGroupStat" :key="group.ageGroup">
                                            {{ group.ageGroup }}: {{ group.percent }}%
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!-- Финансы -->
                    <div class="tab-pane fade text-black fs-5" id="finance" role="tabpanel">
                        <h5>Финанасы</h5>
                        <div class="row my-3">
                        <div class="col-md-4">
                            <div class="equal-card border rounded bg-light">
                                <h5>Общая выручка</h5>
                                <p class="fs-4">{{ stats.totalIncome }} ₽</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="equal-card border rounded bg-light">
                                <h5>Выручка за месяц</h5>
                                <p class="fs-4">{{ stats.monthlyIncome }} ₽</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="equal-card border rounded bg-light">
                                <h5>Средний чек</h5>
                                <p class="fs-4">{{ stats.clinicAvgCheck }} ₽</p>
                            </div>
                        </div>
                    </div>

                    </div>
                </div>
            </div>
            <!-- Vue 3 -->
            <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
            <script src="static/js/admins_stats.js"></script>
        </div>
    </main>
    <footer class="bg-dark text-white-50">
        <div class="container">
            <div class="col-md pb-2 pt-2">
                <p class="mb-0 text-white">&copy; 2008 - 2025. ООО «ПРИМАстом». Лицензия № ЛО-25-01-002504 от 01 декабря 2014г.</p>
            </div>
        </div>
    </footer>
    <script src="static/assets/js/popper.min.js"></script>
    <script src="static/bootstrap/js/bootstrap.min.js"></script>
</div>
</body>
</html>
